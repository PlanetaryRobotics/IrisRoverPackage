<component name="Camera" kind="passive" namespace="CubeRover">
    <import_port_type>CubeRover/CubeRoverPorts/FileDownlink/FileDownlinkPortAi.xml</import_port_type>
    <import_port_type>CubeRover/CubeRoverPorts/CameraSelect/CameraSelectPortAi.xml</import_port_type>

    <comment>Manages the CubeRover cameras</comment>
    <ports>
        <port name="takeImage" data_type="CubeRover::CameraSelect" kind="sync_input" max_number="2">
            <comment>
                Command component to take an image. This port is for other components to request an image to be taken (Navigation).
                The argument is the callbackId identifying the movement command which triggered the image to be taken.
                0: Camera 0     1: Camera 1
            </comment>
        </port>
        <port name="downlinkImage" data_type="CubeRover::FileDownlink" kind="output" max_number="1">
            <comment>
                Send an image to GroundInterface for downlink.
            </comment>
        </port>
    </ports>
            
    <!-- Any logs?? <events>
    </events>-->
    
    <telemetry>
        <channel id="0" name="Cam_ComponentImagesRequested" data_type="U32" update = "on_change">
            <comment>
                Number of images requested by other Fprime components
            </comment>
        </channel>
        <channel id="1" name="Cam_CommandImagesRequested" data_type="U32" update = "on_change">
            <comment>
                Number of images commanded from the ground
            </comment>
        </channel>
        <channel id="2" name="Cam_ImagesSent" data_type="U32" update = "on_change">
            <comment>
                Number of images sent for downlink
            </comment>
        </channel>
        <channel id="3" name="Cam_BytesSent" data_type="U32" update = "on_change">
            <comment>
                Number of bytes sent for downlink
            </comment>
        </channel>
        <channel id="4" name="Cam_PrevCallbackId" data_type="U16" update="on_change">
            <comment>
                The latest callback ID that triggerd an image to be taken
            </comment>
        </channel>
        <!-- Error telemetry items? -->
    </telemetry>
        
    <commands>
        <command kind="sync" opcode="0x0" mnemonic="Get_Status">
            <comment>
                Get camera status
            </comment>
        </command>
        <command kind="sync" opcode="0x1" mnemonic="Take_Image">
            <comment>
                Take an Image
            </comment>
            <args>
                <arg name="camera_num" type="U8">
                    <comment>
                        0: Camera 0     1: Camera 1
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x2" mnemonic="Error">
            <comment>
                Get camera status
            </comment>
            <args>
                <arg name="action" type="U8">
                    <comment>
                        0x00: Clear Error     0xff: Read Error  !! Not sure how this is being used
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x3" mnemonic="Configure_Camera0">
            <comment>
                Configure camera 0
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing camera configurations. TODO: Copy the bit fields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x4" mnemonic="Camera0_Crop">
            <comment>
                Defines the crop for camera 0
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing crop locations. TODO: Copy bitfields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x5" mnemonic="Configure_Camera1">
            <comment>
                Configure camera 1
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing camera configurations. TODO: Copy the bit fields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x6" mnemonic="Camera1_Crop">
            <comment>
                Defines the crop for camera 1
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing crop locations. TODO: Copy bitfields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x7" mnemonic="Read_Image">
            <comment>
                Downlink image generated by a sequence number
            </comment>
            <args>
                <arg name="callbackID" type="U16">
                    <comment>
                        DRedownlink an image generated from the specified callbac
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x8" mnemonic="Erase_Image">
            <comment>
                TBD
            </comment>
        </command>
        <command kind="sync" opcode="0x9" mnemonic="Soft_Camera_Reset">
            <comment>
                Does a soft reset of the camera (and something with the FPGA)
            </comment>
            <args>
                <arg name="cameraNum" type="U8">
                    <comment>
                        Camera Number
                    </comment>
                </arg>
            </args>
        </command>
        <command kind="sync" opcode="0xa" mnemonic="Image_Dump">
            <comment>
                TBD
            </comment>
        </command>
    </commands>
</component>

