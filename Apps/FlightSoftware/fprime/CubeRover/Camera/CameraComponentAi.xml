<component name="Camera" kind="passive" namespace="CubeRover">
    <import_port_type>CubeRover/CubeRoverPorts/FileDownlink/FileDownlinkPortAi.xml</import_port_type>
    <import_port_type>Fw/Time/TimePortAi.xml</import_port_type>
    <import_port_type>CubeRover/CubeRoverPorts/CameraTakePicture/CameraTakePicturePortAi.xml</import_port_type>

    <comment>Manages the CubeRover cameras</comment>
    <ports>
        <port name="takePicture" data_type="CubeRover::CameraTakePicture" kind="sync_input" max_number="2">
            <comment>
                This port is for other components to request an picture to be taken (Navigation).
            </comment>
        </port>
        <port name="downlinkImage" data_type="CubeRover::FileDownlink" kind="output" max_number="1">
            <comment>
                Send an image to GroundInterface for downlink.
            </comment>
        </port>
    </ports>
            
  <!-- EVENTS -->
  <events>
    <event id="0" name="Camera_FailedToTakeImage" severity="WARNING_LO" format_string="Failed to capture image. Try again.">
    	<!--This is a really basic default event. Added this so Camera component would have a Log port that we could connect to ActiveLogger so, if we want to add detailed logs in the future, it's not burdensome.-->
        <comment>A basic notification that, for some reason, the camera failed to capture an image. Try again.</comment>
    </event>
  </events>
    
    <telemetry>
        <channel id="0" name="Cam_ComponentImagesRequested" data_type="U32" update = "on_change">
            <comment>
                Number of images requested by other Fprime components
            </comment>
        </channel>
        <channel id="1" name="Cam_CommandImagesRequested" data_type="U32" update = "on_change">
            <comment>
                Number of images commanded from the ground
            </comment>
        </channel>
        <channel id="2" name="Cam_ImagesSent" data_type="U32" update = "on_change">
            <comment>
                Number of images sent for downlink
            </comment>
        </channel>
        <channel id="3" name="Cam_BytesSent" data_type="U32" update = "on_change">
            <comment>
                Number of bytes sent for downlink
            </comment>
        </channel>
        <channel id="4" name="Cam_LatestCallbackId" data_type="U16" update="on_change">
            <comment>
                The latest callback ID that triggerd an image to be taken
            </comment>
        </channel>
        <!-- Error telemetry items? -->
    </telemetry>
        
    <commands>
        <command kind="sync" opcode="0x0" mnemonic="Get_Status">
            <comment>
                Get camera status
            </comment>
        </command>
        <command kind="sync" opcode="0x1" mnemonic="Take_Image">
            <comment>
                Take an Image
            </comment>
            <args>
                <arg name="camera_num" type="U8">
                    <comment>
                        0: Camera 0     1: Camera 1
                    </comment>
                </arg>
                <arg name="callback_id" type="U16">
                    <comment>
                        Identifier which will be downlinked with the images from this command, allowing us to map which downlinked images related to which 'take photo' command
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x2" mnemonic="Error">
            <comment>
                Get camera status
            </comment>
            <args>
                <arg name="action" type="U8">
                    <comment>
                        0x00: Clear Error     0xff: Read Error  !! Not sure how this is being used
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x3" mnemonic="Configure_Camera0">
            <comment>
                Configure camera 0
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing camera configurations. TODO: Copy the bit fields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x4" mnemonic="Camera0_Crop">
            <comment>
                Defines the crop for camera 0
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing crop locations. TODO: Copy bitfields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x5" mnemonic="Configure_Camera1">
            <comment>
                Configure camera 1
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing camera configurations. TODO: Copy the bit fields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x6" mnemonic="Camera1_Crop">
            <comment>
                Defines the crop for camera 1
            </comment>
            <args>
                <arg name="config" type="U64">
                    <comment>
                        Packed bitfield containing crop locations. TODO: Copy bitfields from C&amp;TL to here
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x7" mnemonic="Read_Image">
            <comment>
                Downlink image generated by a sequence number
            </comment>
            <args>
                <arg name="callbackID" type="U16">
                    <comment>
                        DRedownlink an image generated from the specified callbac
                    </comment>
                </arg>
             </args>
        </command>
        <command kind="sync" opcode="0x8" mnemonic="Erase_Image">
            <comment>
                TBD
            </comment>
        </command>
        <command kind="sync" opcode="0x9" mnemonic="Soft_Camera_Reset">
            <comment>
                Does a soft reset of the camera (and something with the FPGA)
            </comment>
            <args>
                <arg name="cameraNum" type="U8">
                    <comment>
                        Camera Number
                    </comment>
                </arg>
            </args>
        </command>
        <command kind="sync" opcode="0xa" mnemonic="Image_Dump">
            <comment>
                Dump (downlink) whatever is stored in the the camera flash rn 
                without capturing a new image or writing anything to flash 
                first.
            </comment>
        </command>
        <command kind="sync" opcode="0xb" mnemonic="Downlink_Grid">
            <comment>
                Downlinks a test grid. If `viaFlash`, grid will be written to
                flash then read from flash and downlinked. Otherwise, it'll
                just be downlinked directly.
            </comment>
            <args>
                <arg name="viaFlash" type="bool">
                    <comment>
                    Whether or not to write to flash and read from flash before
                    downlinking.
                    </comment>
                </arg>
            </args>
        </command>
        <command kind="sync" opcode="0xc" mnemonic="Downlink_Test_Sequence">
            <comment>
                Downlinks a test image where every 4B are an incrementing U32.
                If `viaFlash`, grid will be written to flash then read from
                flash and downlinked. Otherwise, it'll just be downlinked
                directly.
            </comment>
            <args>
                <arg name="viaFlash" type="bool">
                    <comment>
                    Whether or not to write to flash and read from flash before
                    downlinking.
                    </comment>
                </arg>
            </args>
        </command>
    </commands>
</component>

