<component name="UdpInterface" kind="passive" namespace="CubeRover">

    <import_port_type>Svc/Sched/SchedPortAi.xml</import_port_type>
    <import_port_type>Fw/Buffer/BufferSendPortAi.xml</import_port_type>

    <comment>Handles encapsulation of UDP data flowing in and out of Fprime</comment>
    <ports>
        <!-- Uplink Ports -->
        <port name="uplinkData" data_type="Fw::BufferSend" kind="sync_input" max_number="1">
            <comment>
                A comm source sends a buffer pointing to the datagram and the size of
                datagram that was received. UDPInterface will validate the
                datagram and foward the **payload** to GroundInterface via forwardDatagramPayload.
            </comment>
        </port>
        <port name="forwardDatagramPayload" data_type="Fw::BufferSend" kind="output" max_number="1">
            <comment>
                 Send the**payload** of the received datagram to GroundInterface.
            </comment>
        </port>
            
        <!-- Downlink Ports -->
        <port name="downlinkData" data_type="Fw::BufferSend" kind="sync_input" max_number="1">
            <comment>
                GroundInterface sends a buffer pointing to a datagram with the payload filled.
                This component will generate the checksum, compute the datagram length, and fill
                the port numbers in the header and forward the completed datagram to Watchdog
                for downlink.
            </comment>
        </port>
        <port name="forwardDatagram" data_type="Fw::BufferSend" kind="output" max_number="1">
            <comment>
                 Send the completed datagram to Watchdog.
            </comment>
        </port>
    </ports>
            
    <events>
        <event id="0" name="UR_SendError" severity="WARNING_HI" format_string = "UdpInterface send error: %d">
            <comment>
            UDP send error
            </comment>
            <args>
                <arg name = "error" type = "I32"/>
            </args>
        </event>
        <event id="1" name="UR_RecvError" severity="WARNING_HI" format_string = "UDPInterface receive error: %d">
            <comment>
            UDP receive error
            </comment>
            <args>
                <arg name = "error" type = "I32"/>
            </args>
        </event>
        <event id="2" name="UR_DecodeError" severity="WARNING_HI" format_string = "Port decode error in stage %d: %d" throttle="5">
            <comment>
            Port decode error
            </comment>
            <args>
                <arg name="stage" type="ENUM">
                    <enum name="DecodeStage">
                        <item name="DECODE_HEADER"/>
                        <item name="DECODE_PAYLOAD"/>           
                    </enum>
                </arg>
                <arg name = "error" type = "I32"/>
            </args>
        </event>
        <event id="5" name="UR_DroppedPacket" severity="WARNING_HI" format_string = "UDP packet(s) dropped (checksum %d)" throttle="5">
            <comment>
            Dropped packet was detected
            </comment>
            <args>
                <arg name = "checksum" type = "U32"/>
            </args>
        </event>
    </events>
    
    <telemetry>
        <channel id="0" name="UR_PacketsSent" data_type="U32" update = "on_change">
            <comment>
            Number of packetssent 
            </comment>
        </channel>
        <channel id="1" name="UR_BytesSent" data_type="U32" update = "on_change">
            <comment>
            Number of bytes sent 
            </comment>
        </channel>
        <channel id="2" name="UR_PacketsReceived" data_type="U32" update = "on_change">
            <comment>
            Number of packets received
            </comment>
        </channel>
        <channel id="3" name="UR_BytesReceived" data_type="U32" update = "on_change">
            <comment>
            Number of bytes received
            </comment>
        </channel>
        <channel id="4" name="UR_PacketsDropped" data_type="U32" update = "on_change">
            <comment>
            Number of packets dropped
            </comment>
        </channel>
        <channel id="5" name="UR_DecodeErrors" data_type="U32" update = "on_change">
            <comment>
            Number of packet decode errors
            </comment>
        </channel>
    </telemetry>
</component>

